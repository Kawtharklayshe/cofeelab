$(document).ready(function () {
    // ... your existing code ...

    // Fetch categories from the API with headers
    $.ajax({
        // ... your existing code ...
        success: function (data) {
            // ... your existing code ...

            // Attach click event handler to filter links
            $('#filterList a').on('click', function (event) {
                event.preventDefault();
                var selectedFilter = $(this).data('filter');
                $('#loadingSpinner').show();
                $('#projectGrid').empty();

                // Fetch data based on the selected filter
                $.ajax({
                    // ... your existing code ...
                    success: function (filteredData) {
                        // ... your existing code ...

                        var gridContainer = $('.grid__inner');
                        gridContainer.empty();
                        gridContainer.append('<div class="grid-sizer"></div>');

                        // Initialize variables to track the number of items in each row
                        var itemsInRow = 0;
                        var itemsPerRow = 3; // You can adjust this based on your design

                        // Iterate through the filtered data and create grid items
                        filteredData.data.items.forEach(function (item, index) {
                            // Check if the maximum number of items per row is reached
                            if (itemsInRow % itemsPerRow === 0) {
                                gridContainer.append('<div class="row"></div>');
                            }

                            var gridItem = `
                                <div class="col-12 col-md-6 col-xl-4">
                                    <div class="grid-item__inner">
                                        <div class="grid-item__content-wrapper">
                                            <div class="post-02">
                                                <div class="post-02__media"><a href="project-detail.html"><img src="${item.image}" alt=""/></a></div>
                                                <div class="post-02__body">
                                                    <h2 class="post-02__title"><a href="project-detail.html">${item.name}</a></h2>
                                                    <div class="post-02__department">${item.description}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;

                            // Append the grid item to the current row
                            gridContainer.find('.row:last').append(gridItem);

                            // Increment the count of items in the current row
                            itemsInRow++;
                        });

                        // Calculate the height of grid__inner based on the number of rows
                        var numRows = Math.ceil(filteredData.data.items.length / itemsPerRow);
                        var rowHeight = 300; // You can adjust this based on your design
                        var gridInnerHeight = numRows * rowHeight;
                        gridContainer.css('height', gridInnerHeight + 'px');

                        // Hide the loading spinner
                        $('#loadingSpinner').hide();
                    },
                    error: function (error) {
                        console.error('Error fetching filtered data:', error);
                    }
                });
            });
        },
        error: function (error) {
            console.error('Error fetching categories:', error);
        }
    });
});
